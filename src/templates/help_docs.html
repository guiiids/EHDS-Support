<!DOCTYPE html>
<html lang="en" class="h-full antialiased">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ article.article_title if article else 'Documentation' }} - Help Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        display: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        sky: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    },
                    maxWidth: {
                        '8xl': '88rem',
                    }
                }
            }
        }
    </script>
    <style>
        .prose {
            max-width: 65ch;
        }

        .prose h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #0f172a;
            scroll-margin-top: 5rem;
        }

        .dark .prose h2 {
            color: #f1f5f9;
        }

        .prose h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #1e293b;
            scroll-margin-top: 5rem;
        }

        .dark .prose h3 {
            color: #e2e8f0;
        }

        .prose p {
            margin-bottom: 1rem;
            line-height: 2rem;
            color: #475569;
        }

        .dark .prose p {
            color: #cbd5e1;
        }

        .prose ul,
        .prose ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }

        .prose li {
            margin-bottom: 0.5rem;
            line-height: 2rem;
            color: #475569;
        }

        .dark .prose li {
            color: #cbd5e1;
        }

        .prose a {
            color: #0ea5e9;
            text-decoration: underline;
        }

        .prose a:hover {
            color: #0284c7;
        }

        .prose img {
            max-width: 100%;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
        }

        .prose strong {
            font-weight: 600;
            color: #0f172a;
        }

        .dark .prose strong {
            color: #f1f5f9;
        }

        .nav-link-active {
            font-weight: 600;
            color: #0ea5e9;
        }

        .nav-link-active::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -0.25rem;
            height: 0.375rem;
            width: 0.375rem;
            transform: translateY(-50%);
            border-radius: 9999px;
            background-color: #0ea5e9;
        }

        .toc-link-active {
            color: #0ea5e9;
        }

        #search-modal {
            backdrop-filter: blur(8px);
        }

        .search-result:hover {
            background-color: rgba(14, 165, 233, 0.1);
        }
    </style>
</head>

<body class="flex min-h-full bg-white dark:bg-slate-900">
    <div class="flex w-full flex-col">
        <!-- Header -->
        <header
            class="sticky top-0 z-50 flex flex-none flex-wrap items-center justify-between bg-white px-4 py-5 shadow-md shadow-slate-900/5 transition duration-500 sm:px-6 lg:px-8 dark:bg-slate-900/95 dark:backdrop-blur-sm dark:shadow-none">
            <div class="mr-6 flex lg:hidden">
                <button onclick="toggleMobileMenu()"
                    class="relative z-10 flex h-8 w-8 items-center justify-center text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
            <div class="relative flex grow basis-0 items-center">
                <a href="{{ url_for('help_articles.docs_index') }}" class="flex items-center gap-3">
                    <div
                        class="h-9 w-9 rounded-lg bg-gradient-to-br from-sky-400 to-sky-600 flex items-center justify-center shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <span class="hidden lg:block font-bold text-slate-700 dark:text-slate-100 text-lg">Help
                        Center</span>
                </a>
            </div>
            <div class="-my-5 mr-6 sm:mr-8 md:mr-0">
                <button onclick="openSearchModal()"
                    class="group flex h-6 w-6 items-center justify-center sm:justify-start md:h-auto md:w-80 md:flex-none md:rounded-lg md:py-2.5 md:pl-4 md:pr-3.5 md:text-sm md:ring-1 md:ring-slate-200 md:hover:ring-slate-300 lg:w-96 dark:md:bg-slate-800/75 dark:md:ring-inset dark:md:ring-white/5 dark:md:hover:bg-slate-700/40 dark:md:hover:ring-slate-500">
                    <svg class="h-5 w-5 flex-none fill-slate-400 group-hover:fill-slate-500 md:group-hover:fill-slate-400 dark:fill-slate-500"
                        viewBox="0 0 20 20">
                        <path
                            d="M16.293 17.707a1 1 0 0 0 1.414-1.414l-1.414 1.414ZM9 14a5 5 0 0 1-5-5H2a7 7 0 0 0 7 7v-2ZM4 9a5 5 0 0 1 5-5V2a7 7 0 0 0-7 7h2Zm5-5a5 5 0 0 1 5 5h2a7 7 0 0 0-7-7v2Zm8.707 12.293-3.757-3.757-1.414 1.414 3.757 3.757 1.414-1.414ZM14 9a4.98 4.98 0 0 1-1.464 3.536l1.414 1.414A6.98 6.98 0 0 0 16 9h-2Zm-1.464 3.536A4.98 4.98 0 0 1 9 14v2a6.98 6.98 0 0 0 4.95-2.05l-1.414-1.414Z" />
                    </svg>
                    <span class="sr-only md:not-sr-only md:ml-2 md:text-slate-500 md:dark:text-slate-400">Search
                        docs</span>
                    <kbd
                        class="ml-auto hidden font-medium text-slate-400 dark:text-slate-500 md:block"><span>⌘</span><span>K</span></kbd>
                </button>
            </div>
            <div class="relative flex basis-0 justify-end gap-6 sm:gap-8 md:grow">
                <button onclick="toggleTheme()"
                    class="relative z-10 flex h-6 w-6 items-center justify-center text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300">
                    <svg class="hidden dark:block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <svg class="block dark:hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
                <a href="{{ url_for('help_articles.help_list') }}"
                    class="text-sm text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300 flex items-center gap-2">
                    <span>List View</span>
                </a>
                <a href="/"
                    class="text-sm text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300 flex items-center gap-2">
                    <span>Back to Hub</span>
                </a>
            </div>
        </header>

        <!-- Main Content -->
        <div class="relative mx-auto flex w-full max-w-8xl flex-auto justify-center sm:px-2 lg:px-8 xl:px-12">
            <!-- Left Sidebar Navigation -->
            <div class="hidden lg:relative lg:block lg:flex-none">
                <div class="absolute inset-y-0 right-0 w-[50vw] bg-slate-50 dark:hidden"></div>
                <div
                    class="absolute top-16 right-0 bottom-0 hidden h-12 w-px bg-gradient-to-t from-slate-800 dark:block">
                </div>
                <div class="absolute top-28 right-0 bottom-0 hidden w-px bg-slate-800 dark:block"></div>
                <div
                    class="sticky top-[4.75rem] -ml-0.5 h-[calc(100vh-4.75rem)] w-64 overflow-y-auto py-16 pr-8 pl-0.5 xl:w-72 xl:pr-16">
                    <nav class="text-base lg:text-sm">
                        <ul role="list" class="space-y-9">
                            {% for section in navigation %}
                            <li>
                                <h2 class="font-display font-medium text-slate-900 dark:text-white">{{ section.title }}
                                </h2>
                                <ul role="list"
                                    class="mt-2 space-y-2 border-l-2 border-slate-100 lg:mt-4 lg:space-y-4 lg:border-slate-200 dark:border-slate-800">
                                    {% for link in section.links %}
                                    <li class="relative">
                                        <a href="{{ link.href }}"
                                            class="block w-full pl-3.5 before:pointer-events-none before:absolute before:top-1/2 before:-left-1 before:h-1.5 before:w-1.5 before:-translate-y-1/2 before:rounded-full {% if link.href == current_path %}nav-link-active{% else %}text-slate-500 before:hidden before:bg-slate-300 hover:text-slate-600 hover:before:block dark:text-slate-400 dark:before:bg-slate-700 dark:hover:text-slate-300{% endif %}">
                                            {{ link.title }}
                                        </a>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </li>
                            {% endfor %}
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Main Article Content -->
            {% if article %}
            <div class="min-w-0 max-w-2xl flex-auto px-4 py-16 lg:max-w-none lg:pr-0 lg:pl-8 xl:px-16">
                <article>
                    <header class="mb-9 space-y-1">
                        <p class="font-display text-sm font-medium text-sky-500">{{ article.breadcrumbs or
                            'Documentation' }}</p>
                        <h1 class="font-display text-3xl tracking-tight text-slate-900 dark:text-white">
                            {{ article.article_title }}
                        </h1>
                    </header>
                    <div class="prose">
                        {{ article.article_text|safe }}
                    </div>
                </article>

                <!-- Previous/Next Links -->
                <dl class="mt-12 flex border-t border-slate-200 pt-6 dark:border-slate-800">
                    {% if prev_article %}
                    <div>
                        <dt class="font-display text-sm font-medium text-slate-900 dark:text-white">Previous</dt>
                        <dd class="mt-1">
                            <a href="{{ url_for('help_articles.docs_article', article_id=prev_article.id) }}"
                                class="text-base font-semibold text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300">
                                <span aria-hidden="true">←</span> {{ prev_article.article_title }}
                            </a>
                        </dd>
                    </div>
                    {% endif %}
                    {% if next_article %}
                    <div class="ml-auto text-right">
                        <dt class="font-display text-sm font-medium text-slate-900 dark:text-white">Next</dt>
                        <dd class="mt-1">
                            <a href="{{ url_for('help_articles.docs_article', article_id=next_article.id) }}"
                                class="text-base font-semibold text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300">
                                {{ next_article.article_title }} <span aria-hidden="true">→</span>
                            </a>
                        </dd>
                    </div>
                    {% endif %}
                </dl>
            </div>

            <!-- Right Sidebar - Table of Contents -->
            <div
                class="hidden xl:sticky xl:top-[4.75rem] xl:-mr-6 xl:block xl:h-[calc(100vh-4.75rem)] xl:flex-none xl:overflow-y-auto xl:py-16 xl:pr-6">
                <nav aria-labelledby="on-this-page-title" class="w-56">
                    <h2 id="on-this-page-title" class="font-display text-sm font-medium text-slate-900 dark:text-white">
                        On this page
                    </h2>
                    <ol role="list" class="mt-4 space-y-3 text-sm" id="toc-list">
                        <!-- Generated by JavaScript -->
                    </ol>
                </nav>
            </div>
            {% else %}
            <!-- Home/Index Page -->
            <div class="min-w-0 max-w-2xl flex-auto px-4 py-16 lg:max-w-none lg:pr-0 lg:pl-8 xl:px-16">
                <header class="mb-9 space-y-1">
                    <p class="font-display text-sm font-medium text-sky-500">Welcome</p>
                    <h1 class="font-display text-3xl tracking-tight text-slate-900 dark:text-white">
                        Help Center Documentation
                    </h1>
                </header>
                <p class="text-lg text-slate-700 dark:text-slate-400">
                    Browse our comprehensive documentation to find answers to your questions. Use the sidebar to
                    navigate through categories.
                </p>
                <div class="mt-10 grid grid-cols-1 gap-6 sm:grid-cols-2">
                    {% for section in navigation %}
                    <div
                        class="relative rounded-xl border border-slate-200 p-6 hover:shadow-md transition-shadow dark:border-slate-800">
                        <h3 class="font-display text-lg font-semibold text-slate-900 dark:text-white">{{ section.title
                            }}</h3>
                        <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">{{ section.links|length }} articles
                            available</p>
                        <a href="{{ section.links[0].href }}"
                            class="mt-4 inline-flex items-center text-sm font-medium text-sky-500">
                            Start reading <span aria-hidden="true" class="ml-1">→</span>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Search Modal -->
    <div id="search-modal" class="hidden fixed inset-0 z-50 bg-slate-900/50 dark:bg-slate-900/80"
        onclick="closeSearchModal(event)">
        <div class="fixed inset-0 flex items-start justify-center pt-[20vh] px-4">
            <div class="w-full max-w-2xl bg-white dark:bg-slate-800 rounded-xl shadow-2xl"
                onclick="event.stopPropagation()">
                <div class="relative">
                    <svg class="pointer-events-none absolute top-4 left-4 h-6 w-6 fill-slate-400" viewBox="0 0 20 20">
                        <path
                            d="M16.293 17.707a1 1 0 0 0 1.414-1.414l-1.414 1.414ZM9 14a5 5 0 0 1-5-5H2a7 7 0 0 0 7 7v-2ZM4 9a5 5 0 0 1 5-5V2a7 7 0 0 0-7 7h2Zm5-5a5 5 0 0 1 5 5h2a7 7 0 0 0-7-7v2Zm8.707 12.293-3.757-3.757-1.414 1.414 3.757 3.757 1.414-1.414ZM14 9a4.98 4.98 0 0 1-1.464 3.536l1.414 1.414A6.98 6.98 0 0 0 16 9h-2Zm-1.464 3.536A4.98 4.98 0 0 1 9 14v2a6.98 6.98 0 0 0 4.95-2.05l-1.414-1.414Z" />
                    </svg>
                    <input type="text" id="search-input" placeholder="Find something..."
                        class="w-full border-0 bg-transparent pl-12 pr-4 py-4 text-slate-900 placeholder:text-slate-400 focus:outline-none dark:text-white sm:text-sm"
                        oninput="performSearch(this.value)">
                </div>
                <div id="search-results"
                    class="max-h-96 overflow-y-auto border-t border-slate-200 dark:border-slate-700">
                    <!-- Search results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme Management
        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialize theme from localStorage
        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        // Search Modal
        function openSearchModal() {
            document.getElementById('search-modal').classList.remove('hidden');
            document.getElementById('search-input').focus();
        }

        function closeSearchModal(event) {
            if (event && event.target.id !== 'search-modal') return;
            document.getElementById('search-modal').classList.add('hidden');
            document.getElementById('search-input').value = '';
            document.getElementById('search-results').innerHTML = '';
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function (e) {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                openSearchModal();
            }
            if (e.key === 'Escape') {
                closeSearchModal({ target: { id: 'search-modal' } });
            }
        });

        // Search functionality
        async function performSearch(query) {
            if (!query) {
                document.getElementById('search-results').innerHTML = '';
                return;
            }

            try {
                const response = await fetch(`{{ url_for('help_articles.api_search') }}?q=${encodeURIComponent(query)}`);
                const results = await response.json();

                const resultsHtml = results.map(result => `
                    <a href="{{ url_for('help_articles.docs_article', article_id=0) }}".replace('0', result.id) 
                       class="search-result block px-4 py-3 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors"
                       onclick="closeSearchModal({ target: { id: 'search-modal' } })">
                        <div class="font-medium text-slate-900 dark:text-white">${result.article_title}</div>
                        ${result.breadcrumbs ? `<div class="text-sm text-slate-500 dark:text-slate-400">${result.breadcrumbs}</div>` : ''}
                    </a>
                `).join('');

                document.getElementById('search-results').innerHTML = resultsHtml || '<div class="px-4 py-8 text-center text-sm text-slate-500 dark:text-slate-400">No results found</div>';
            } catch (error) {
                console.error('Search error:', error);
            }
        }

        // Table of Contents Generation
        function generateTOC() {
            const article = document.querySelector('article .prose');
            if (!article) return;

            const headings = article.querySelectorAll('h2, h3');
            const tocList = document.getElementById('toc-list');
            if (!tocList) return;

            let currentH2 = null;
            let currentSublist = null;

            headings.forEach((heading, index) => {
                const id = heading.id || `heading-${index}`;
                heading.id = id;

                if (heading.tagName === 'H2') {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <h3>
                            <a href="#${id}" class="toc-link font-normal text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300">
                                ${heading.textContent}
                            </a>
                        </h3>
                    `;
                    tocList.appendChild(li);
                    currentH2 = li;
                    currentSublist = null;
                } else if (heading.tagName === 'H3' && currentH2) {
                    if (!currentSublist) {
                        currentSublist = document.createElement('ol');
                        currentSublist.className = 'mt-2 space-y-3 pl-5 text-slate-500 dark:text-slate-400';
                        currentH2.appendChild(currentSublist);
                    }
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <a href="#${id}" class="toc-link hover:text-slate-600 dark:hover:text-slate-300">
                            ${heading.textContent}
                        </a>
                    `;
                    currentSublist.appendChild(li);
                }
            });

            // Scroll spy for TOC
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        document.querySelectorAll('.toc-link').forEach(link => {
                            link.classList.remove('toc-link-active');
                        });
                        const activeLink = document.querySelector(`.toc-link[href="#${entry.target.id}"]`);
                        if (activeLink) {
                            activeLink.classList.add('toc-link-active');
                        }
                    }
                });
            }, { rootMargin: '-100px 0px -66%' });

            headings.forEach(heading => observer.observe(heading));
        }

        // Initialize TOC on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', generateTOC);
        } else {
            generateTOC();
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            alert('Mobile menu not yet implemented');
        }
    </script>
</body>

</html>