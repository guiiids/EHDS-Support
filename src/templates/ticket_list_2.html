<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Ticket Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        surface: {
                            50: '#fafbfc',
                            100: '#f4f5f7',
                            200: '#e1e4e8',
                            300: '#d1d5db',
                            400: '#959da5',
                            500: '#6b7280',
                            600: '#586069',
                            700: '#444d56',
                            800: '#2f363d',
                            900: '#1b1f23',
                        }
                    },
                    boxShadow: {
                        'card': '0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 4px 6px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.06)',
                        'elevated': '0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Premium row hover effect - elevate */
        .ticket-row {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ticket-row:hover {
            background-color: rgba(59, 130, 246, 0.04);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        /* Subtle gradient backgrounds */
        .header-gradient {
            background: linear-gradient(to right, #1e40af 0%, #3b82f6 100%);
        }

        /* Stats badge animation */
        .stats-badge {
            transition: all 0.15s ease;
        }

        .stats-badge:hover {
            transform: scale(1.02);
        }
    </style>
</head>

<body
    class="bg-surface-50 text-surface-800 font-sans antialiased selection:bg-brand-100 selection:text-brand-700 h-screen overflow-hidden flex flex-col">

    <!-- Macros for Facets -->
    {% macro filter_link(param_name, value, label, count, active_value) %}
    <a href="{{ url_for('ticket_list', **dict(request.args, **{param_name: value, 'page': 1})) }}"
        class="group flex items-center justify-between py-1.5 px-2 rounded-md text-sm transition-colors {{ 'bg-brand-50 text-brand-700 font-medium' if value|string == active_value|string else 'text-surface-600 hover:bg-surface-100 hover:text-surface-900' }}">
        <span class="truncate" title="{{ label }}">{{ label }}</span>
        <span
            class="text-xs {{ 'text-brand-500' if value|string == active_value|string else 'text-surface-400 group-hover:text-surface-500' }}">{{
            count }}</span>
    </a>
    {% endmacro %}

    <!-- Top Navigation - Premium Design -->
    <nav class="bg-white/95 backdrop-blur-sm border-b border-surface-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <!-- Logo / Icon -->
                    <a href="/tickets" class="group flex items-center gap-3">
                        <div
                            class="h-9 w-9 rounded-lg bg-gradient-to-br from-blue-400 to-blue-800 flex items-center justify-center shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-bold text-surface-700 text-base tracking-tight leading-tight">Support
                                Archive</span>
                            <span class="text-xs text-surface-500 font-medium">TeamSupport</span>
                        </div>
                    </a>
                </div>

                <!-- Template Selector & Stats -->
                <div class="flex items-center gap-4">
                    <form action="/set-template" method="POST" class="flex items-center gap-2">
                        <label for="template_select"
                            class="text-xs font-semibold text-surface-400 uppercase tracking-wider">View:</label>
                        <select id="template_select" name="template" onchange="this.form.submit()"
                            class="text-sm font-medium text-surface-700 bg-surface-50 border border-surface-200 rounded-lg px-3 py-1.5 focus:ring-brand-500 focus:border-brand-500 cursor-pointer hover:bg-surface-100 transition-colors shadow-sm">
                            <option value="ticket_detail" {% if current_template=='ticket_detail' %}selected{% endif %}>
                                Classic</option>
                            <option value="ticket_detail2" {% if current_template=='ticket_detail2' %}selected{% endif
                                %}>Enterprise</option>
                            <option value="ticket_detail3" {% if current_template=='ticket_detail3' %}selected{% endif
                                %}>Premium</option>
                            <option value="ticket_detail4" {% if current_template=='ticket_detail4' %}selected{% endif
                                %}>Premium + Notes</option>
                        </select>
                    </form>
                    <div class="h-5 w-px bg-surface-200"></div>
                    <div
                        class="stats-badge inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-100 border border-surface-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-brand-500" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                        <span class="text-sm text-surface-600"><strong class="text-surface-700">{{ filtered_count
                                }}</strong> of <strong class="text-surface-700">{{
                                total_count }}</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content with Sidebar -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-1 min-h-0 flex flex-col w-full h-[calc(100vh-64px)]">
        <div class="flex flex-1 min-h-0">

            <!-- Sidebar Filters -->
            <aside
                class="w-64 pr-6 py-2 overflow-y-auto hidden lg:block border-r border-surface-200 custom-scrollbar mr-6">

                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-sm font-bold text-surface-900 uppercase tracking-wider">Filters</h2>
                    {% if filters %}
                    <a href="/tickets{% if search_query %}?q={{ search_query }}{% endif %}"
                        class="text-xs font-medium text-brand-600 hover:text-brand-700 hover:underline">
                        Clear All
                    </a>
                    {% endif %}
                </div>

                <!-- 1. Status -->
                {% if facets.status %}
                <div class="mb-8">
                    <h3 class="px-2 text-xs font-bold text-surface-400 uppercase tracking-wider mb-2">Status</h3>
                    <div class="space-y-0.5">
                        {% for item_val, count in facets.status %}
                        {{ filter_link('status', item_val, item_val, count, filters.status) }}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- 2. Year & Month (Grouped) -->
                {% if facets.year %}
                <div class="mb-8">
                    <h3 class="px-2 text-xs font-bold text-surface-400 uppercase tracking-wider mb-2">Date</h3>
                    <div class="space-y-0.5 mb-3">
                        {% for item_val, count in facets.year %}
                        {{ filter_link('year', item_val, item_val, count, filters.year) }}
                        {% endfor %}
                    </div>
                    {% if facets.month and filters.year %}
                    <div class="pl-2 space-y-0.5 border-l-2 border-surface-100 ml-2">
                        {% for m_id, m_name, count in facets.month %}
                        {{ filter_link('month', m_id, m_name, count, filters.month) }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- 3. Category -->
                {% if facets.category %}
                <div class="mb-8">
                    <h3 class="px-2 text-xs font-bold text-surface-400 uppercase tracking-wider mb-2">Category</h3>
                    <div class="space-y-0.5">
                        {% for item_val, count in facets.category[:5] %}
                        {{ filter_link('category', item_val, item_val, count, filters.category) }}
                        {% endfor %}

                        {% if facets.category|length > 5 %}
                        <div id="more-category" class="hidden space-y-0.5">
                            {% for item_val, count in facets.category[5:] %}
                            {{ filter_link('category', item_val, item_val, count, filters.category) }}
                            {% endfor %}
                        </div>
                        <button
                            onclick="document.getElementById('more-category').classList.remove('hidden'); this.remove();"
                            class="w-full text-left px-2 mt-1 text-xs font-medium text-surface-500 hover:text-brand-600 transition-colors flex items-center gap-1">
                            Show {{ facets.category|length - 5 }} more
                            <svg class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- 4. Subcategory -->
                {% if facets.subcategory %}
                <div class="mb-8">
                    <h3 class="px-2 text-xs font-bold text-surface-400 uppercase tracking-wider mb-2">Subcategory</h3>
                    <div class="space-y-0.5">
                        {% for item_val, count in facets.subcategory[:5] %}
                        {{ filter_link('subcategory', item_val, item_val, count, filters.subcategory) }}
                        {% endfor %}

                        {% if facets.subcategory|length > 5 %}
                        <div id="more-subcategory" class="hidden space-y-0.5">
                            {% for item_val, count in facets.subcategory[5:] %}
                            {{ filter_link('subcategory', item_val, item_val if item_val else '(None)', count,
                            filters.subcategory) }}
                            {% endfor %}
                        </div>
                        <button
                            onclick="document.getElementById('more-subcategory').classList.remove('hidden'); this.remove();"
                            class="w-full text-left px-2 mt-1 text-xs font-medium text-surface-500 hover:text-brand-600 transition-colors flex items-center gap-1">
                            Show {{ facets.subcategory|length - 5 }} more
                            <svg class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- 5. Agent -->
                {% if facets.agent %}
                <div class="mb-8">
                    <h3 class="px-2 text-xs font-bold text-surface-400 uppercase tracking-wider mb-2">Agent</h3>
                    <div class="space-y-0.5">
                        {% for item_val, count in facets.agent[:5] %}
                        {{ filter_link('agent', item_val, item_val, count, filters.agent) }}
                        {% endfor %}

                        {% if facets.agent|length > 5 %}
                        <div id="more-agent" class="hidden space-y-0.5">
                            {% for item_val, count in facets.agent[5:] %}
                            {{ filter_link('agent', item_val, item_val, count, filters.agent) }}
                            {% endfor %}
                        </div>
                        <button
                            onclick="document.getElementById('more-agent').classList.remove('hidden'); this.remove();"
                            class="w-full text-left px-2 mt-1 text-xs font-medium text-surface-500 hover:text-brand-600 transition-colors flex items-center gap-1">
                            Show {{ facets.agent|length - 5 }} more
                            <svg class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- 6. Customer -->
                {% if facets.customer %}
                <div class="mb-8">
                    <h3 class="px-2 text-xs font-bold text-surface-400 uppercase tracking-wider mb-2">Customer</h3>
                    <div class="space-y-0.5">
                        {% for item_val, count in facets.customer[:5] %}
                        {{ filter_link('customer', item_val, item_val, count, filters.customer) }}
                        {% endfor %}

                        {% if facets.customer|length > 5 %}
                        <div id="more-customer" class="hidden space-y-0.5">
                            {% for item_val, count in facets.customer[5:] %}
                            {{ filter_link('customer', item_val, item_val, count, filters.customer) }}
                            {% endfor %}
                        </div>
                        <button
                            onclick="document.getElementById('more-customer').classList.remove('hidden'); this.remove();"
                            class="w-full text-left px-2 mt-1 text-xs font-medium text-surface-500 hover:text-brand-600 transition-colors flex items-center gap-1">
                            Show {{ facets.customer|length - 5 }} more
                            <svg class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </aside>

            <!-- Main List Area -->
            <main class="flex-1 min-w-0 flex flex-col">

                <!-- Header & Controls -->
                <div class="md:flex md:items-center md:justify-between mb-8">
                    <div class="flex-1 min-w-0">
                        <h2 class="text-2xl sm:text-3xl font-extrabold text-surface-700 tracking-tight">
                            My Tickets
                        </h2>
                        <p class="mt-1 text-sm text-surface-500 font-medium">
                            Access your historical support requests and solutions.
                        </p>
                    </div>
                    <div class="mt-4 flex md:mt-0 md:ml-4 gap-3">
                        <!-- Search Group -->
                        <div class="flex items-center gap-3">
                            <form method="GET" action="/tickets" class="relative w-80">
                                <!-- Maintain filters in search -->
                                {% if filters.agent %}<input type="hidden" name="agent" value="{{ filters.agent }}">{%
                                endif %}
                                {% if filters.status %}<input type="hidden" name="status"
                                    value="{{ filters.status }}">{% endif %}
                                {% if filters.category %}<input type="hidden" name="category"
                                    value="{{ filters.category }}">{% endif %}
                                {% if filters.subcategory %}<input type="hidden" name="subcategory"
                                    value="{{ filters.subcategory }}">{% endif %}
                                {% if filters.customer %}<input type="hidden" name="customer"
                                    value="{{ filters.customer }}">{% endif %}
                                {% if filters.year %}<input type="hidden" name="year" value="{{ filters.year }}">{%
                                endif %}
                                {% if filters.month %}<input type="hidden" name="month" value="{{ filters.month }}">{%
                                endif %}

                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-5 w-5 text-surface-400" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                </div>
                                <input type="text" name="q" id="search" value="{{ search_query }}"
                                    class="focus:ring-brand-500 focus:border-brand-500 block w-full pl-10 pr-4 py-2.5 text-sm border border-surface-200 rounded-lg shadow-sm bg-white placeholder-surface-400"
                                    placeholder="Search # or Subject...">
                            </form>
                            {% if search_query or filters %}
                            <a href="/tickets"
                                class="inline-flex items-center px-4 py-2.5 border border-surface-200 rounded-lg shadow-sm text-sm font-medium text-surface-600 bg-white hover:bg-surface-50 hover:text-brand-600 transition-colors">
                                Clear
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Active Filters (Mobile / Visual confirm) -->
                {% if filters %}
                <div class="flex items-center gap-2 mb-4 flex-wrap">
                    <span class="text-xs font-semibold text-surface-400 uppercase tracking-wider mr-1">Active:</span>
                    <!-- Macros for Facets -->
                    {% macro filter_link(param_name, value, label, count, active_value) %}
                    <a href="{{ url_for('ticket_list', **dict(request.args, **{param_name: value, 'page': 1})) }}"
                        class="group flex items-center justify-between py-1.5 px-2 rounded-md text-sm transition-colors {{ 'bg-brand-50 text-brand-700 font-medium' if value|string == active_value|string else 'text-surface-600 hover:bg-surface-100 hover:text-surface-900' }}">
                        <span class="truncate" title="{{ label }}">{{ label }}</span>
                        <span
                            class="text-xs {{ 'text-brand-500' if value|string == active_value|string else 'text-surface-400 group-hover:text-surface-500' }}">{{
                            count }}</span>
                    </a>
                    {% endmacro %}
                    {% for key, val in filters.items() %}
                    <a href="{{ url_for('ticket_list', **dict(request.args, **{key: None, 'page': 1})) }}"
                        class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-brand-50 text-brand-700 hover:bg-brand-100 border border-brand-200 transition-colors group">
                        <span class="font-normal text-brand-500 capitalize">{{ key }}:</span> {{ val }}
                        <svg class="h-3.5 w-3.5 text-brand-400 group-hover:text-brand-600" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                    </a>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Data Table -->
                <div
                    class="bg-white rounded-xl shadow-card border border-surface-200 overflow-hidden flex-1 min-h-0 mb-8">
                    <div class="overflow-y-auto h-full scroll-smooth">
                        <table class="min-w-full divide-y divide-surface-200 border-collapse">
                            <thead class="bg-gradient-to-r from-surface-800 to-surface-900 sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th scope="col"
                                        class="px-6 py-4 text-left text-xs font-bold text-white uppercase tracking-wider">
                                        #
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-4 text-left text-xs font-bold text-white uppercase tracking-wider w-2/5">
                                        Subject
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-4 text-left text-xs font-bold text-white uppercase tracking-wider">
                                        Support Agent
                                    </th>
                                    <th scope="col"
                                        class="px-6 py-4 text-right text-xs font-bold text-white uppercase tracking-wider">
                                        Last Updated
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-surface-100">
                                {% for ticket in tickets %}
                                <tr class="ticket-row cursor-pointer"
                                    data-href="{% if ticket.is_kb %}{{ url_for('canned_responses.kb_detail', article_id=ticket.real_id) }}{% else %}/ticket/{{ ticket.ticket_number }}{% endif %}"
                                    onclick="window.location.href=this.dataset.href">
                                    <!-- Ticket Number -->
                                    <td class="px-6 py-4 whitespace-nowrap border-l-3 border-transparent">
                                        <span
                                            class="font-mono text-sm font-bold text-surface-600 bg-surface-100 px-2.5 py-1 rounded-md">
                                            {{ ticket.ticket_number }}
                                        </span>
                                    </td>
                                    <!-- Subject with Owner | Customer + Status/Category badges -->
                                    <td class="px-6 py-4">
                                        <a href="{% if ticket.is_kb %}{{ url_for('canned_responses.kb_detail', article_id=ticket.real_id) }}{% else %}/ticket/{{ ticket.ticket_number }}{% endif %}"
                                            class="text-sm font-semibold text-surface-700 hover:text-brand-600 transition-colors block">
                                            {{ ticket.ticket_name }}
                                        </a>
                                        <div
                                            class="flex items-center gap-1.5 mt-1.5 text-xs text-surface-500 whitespace-nowrap">
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                class="h-3 w-3 text-surface-400 flex-shrink-0" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                            </svg>
                                            <span class="font-medium truncate max-w-[120px]"
                                                title="{{ ticket.ticket_owner }}">{{ ticket.ticket_owner or 'Unknown'
                                                }}</span>
                                            <span class="text-surface-300 flex-shrink-0">|</span>
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                class="h-3 w-3 text-surface-400 flex-shrink-0" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                            </svg>
                                            <span class="truncate max-w-[150px]" title="{{ ticket.customers }}">{{
                                                ticket.customers or 'Unknown' }}</span>
                                        </div>
                                        <!-- Status and Category badges -->
                                        <div class="flex items-center gap-2 mt-2">
                                            {% if ticket.is_kb %}
                                            <span
                                                class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-bold border bg-indigo-50 text-indigo-700 border-indigo-200">
                                                <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                                                Canned Response
                                            </span>
                                            {% else %}
                                            <span
                                                class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-bold border {{ ticket.status|status_color }}">
                                                <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                                                {{ ticket.status }}
                                            </span>
                                            {% endif %}
                                            {% if ticket.subcategory %}
                                            <span
                                                class="text-xs font-medium text-surface-500 bg-surface-100 px-2 py-0.5 rounded border border-surface-200">
                                                {{ ticket.subcategory }}
                                            </span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <!-- Support Agent -->
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center gap-2">
                                            <div
                                                class="h-7 w-7 rounded-full bg-gradient-to-br from-blue-400 to-blue-800 flex items-center justify-center text-white font-bold text-xs shadow-sm">
                                                {{ ticket.assigned_to|get_initials }}
                                            </div>
                                            <span class="text-sm font-medium text-surface-700">{{ ticket.assigned_to or
                                                'Unassigned' }}</span>
                                        </div>
                                    </td>
                                    <!-- Last Updated -->
                                    <td class="px-6 py-4 whitespace-nowrap text-right">
                                        <span class="text-sm text-surface-500 font-medium"
                                            title="{{ ticket.date_action_created }}">{{
                                            ticket.date_action_created|format_date('%m/%d/%y %I:%M %p') }}</span>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="px-6 py-16 text-center">
                                        <div class="flex flex-col items-center">
                                            <div
                                                class="h-14 w-14 rounded-full bg-surface-100 flex items-center justify-center mb-4">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-surface-400"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                                </svg>
                                            </div>
                                            {% if search_query or filters %}
                                            <p class="text-surface-600 font-semibold">No tickets found</p>
                                            <p class="text-surface-400 text-sm mt-1">No results matching your current
                                                filters.
                                            </p>
                                            <a href="/tickets"
                                                class="mt-4 text-brand-600 hover:text-brand-700 text-sm font-medium hover:underline">Clear
                                                all filters</a>
                                            {% else %}
                                            <p class="text-surface-600 font-semibold">No tickets available</p>
                                            <p class="text-surface-400 text-sm mt-1">There are no tickets in the archive
                                                yet.
                                            </p>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pagination - Premium Design -->
                <div
                    class="bg-white px-5 py-4 flex items-center justify-between border border-surface-200 mt-auto rounded-xl shadow-card">
                    <div class="flex-1 flex items-center justify-between">
                        <!-- Results count -->
                        <div>
                            <p class="text-sm text-surface-600">
                                Showing <span class="font-bold text-surface-700">{{ showing_start }}</span> to <span
                                    class="font-bold text-surface-700">{{
                                    showing_end }}</span> of <span class="font-bold text-surface-700">{{ filtered_count
                                    }}</span> results
                            </p>
                        </div>

                        <!-- Pagination controls -->
                        <nav aria-label="Page navigation" class="flex items-center space-x-4">
                            <ul class="flex -space-x-px text-sm">
                                <!-- Previous button -->
                                <li>
                                    {% if page > 1 %}
                                    <a href="?page={{ page - 1 }}&per_page={{ per_page }}{% if search_query %}&q={{ search_query }}{% endif %}{% for k,v in filters.items() %}&{{ k }}={{ v }}{% endfor %}"
                                        class="flex items-center justify-center bg-white border border-surface-200 hover:bg-brand-50 hover:text-brand-600 hover:border-brand-200 shadow-sm font-semibold leading-5 rounded-l-lg text-sm px-4 h-10 text-surface-600 transition-colors">Previous</a>
                                    {% else %}
                                    <span
                                        class="flex items-center justify-center bg-surface-50 border border-surface-200 shadow-sm font-semibold leading-5 rounded-l-lg text-sm px-4 h-10 text-surface-400 cursor-not-allowed">Previous</span>
                                    {% endif %}
                                </li>

                                <!-- Page numbers -->
                                {% set start_page = [1, page - 2] | max %}
                                {% set end_page = [total_pages, page + 2] | min %}

                                {% if start_page > 1 %}
                                <li>
                                    <a href="?page=1&per_page={{ per_page }}{% if search_query %}&q={{ search_query }}{% endif %}{% for k,v in filters.items() %}&{{ k }}={{ v }}{% endfor %}"
                                        class="flex items-center justify-center bg-white border border-surface-200 hover:bg-brand-50 hover:text-brand-600 hover:border-brand-200 shadow-sm font-semibold leading-5 text-sm w-10 h-10 text-surface-600 transition-colors">1</a>
                                </li>
                                {% if start_page > 2 %}
                                <li>
                                    <span
                                        class="flex items-center justify-center bg-white border border-surface-200 text-sm w-10 h-10 text-surface-400">...</span>
                                </li>
                                {% endif %}
                                {% endif %}

                                {% for p in range(start_page, end_page + 1) %}
                                <li>
                                    {% if p == page %}
                                    <span aria-current="page"
                                        class="flex items-center justify-center text-white bg-gradient-to-br from-brand-500 to-brand-600 border border-brand-500 font-bold text-sm w-10 h-10 shadow-md">{{
                                        p }}</span>
                                    {% else %}
                                    <a href="?page={{ p }}&per_page={{ per_page }}{% if search_query %}&q={{ search_query }}{% endif %}{% for k,v in filters.items() %}&{{ k }}={{ v }}{% endfor %}"
                                        class="flex items-center justify-center bg-white border border-surface-200 hover:bg-brand-50 hover:text-brand-600 hover:border-brand-200 shadow-sm font-semibold leading-5 text-sm w-10 h-10 text-surface-600 transition-colors">{{
                                        p }}</a>
                                    {% endif %}
                                </li>
                                {% endfor %}

                                {% if end_page < total_pages %} {% if end_page < total_pages - 1 %} <li>
                                    <span
                                        class="flex items-center justify-center bg-white border border-surface-200 text-sm w-10 h-10 text-surface-400">...</span>
                                    </li>
                                    {% endif %}
                                    <li>
                                        <a href="?page={{ total_pages }}&per_page={{ per_page }}{% if search_query %}&q={{ search_query }}{% endif %}{% for k,v in filters.items() %}&{{ k }}={{ v }}{% endfor %}"
                                            class="flex items-center justify-center bg-white border border-surface-200 hover:bg-brand-50 hover:text-brand-600 hover:border-brand-200 shadow-sm font-semibold leading-5 text-sm w-10 h-10 text-surface-600 transition-colors">{{
                                            total_pages }}</a>
                                    </li>
                                    {% endif %}

                                    <!-- Next button -->
                                    <li>
                                        {% if page < total_pages %} <a
                                            href="?page={{ page + 1 }}&per_page={{ per_page }}{% if search_query %}&q={{ search_query }}{% endif %}{% for k,v in filters.items() %}&{{ k }}={{ v }}{% endfor %}"
                                            class="flex items-center justify-center bg-white border border-surface-200 hover:bg-brand-50 hover:text-brand-600 hover:border-brand-200 shadow-sm font-semibold leading-5 rounded-r-lg text-sm px-4 h-10 text-surface-600 transition-colors">
                                            Next</a>
                                            {% else %}
                                            <span
                                                class="flex items-center justify-center bg-surface-50 border border-surface-200 shadow-sm font-semibold leading-5 rounded-r-lg text-sm px-4 h-10 text-surface-400 cursor-not-allowed">Next</span>
                                            {% endif %}
                                    </li>
                            </ul>

                            <!-- Per page dropdown -->
                            <form id="perPageForm" class="w-36">
                                <label for="per_page_select" class="sr-only">Items per page</label>
                                <input type="hidden" name="page" value="1">
                                {% if search_query %}
                                <input type="hidden" name="q" value="{{ search_query }}">
                                {% endif %}
                                <!-- Maintain filters -->
                                {% for k,v in filters.items() %}
                                <input type="hidden" name="{{ k }}" value="{{ v }}">
                                {% endfor %}

                                <select id="per_page_select" name="per_page"
                                    onchange="document.getElementById('perPageForm').submit();"
                                    class="block w-full px-3 py-2.5 bg-white border border-surface-200 text-surface-700 text-sm font-medium leading-4 rounded-lg focus:ring-brand-500 focus:border-brand-500 shadow-sm cursor-pointer hover:bg-surface-50 transition-colors">
                                    <option value="10" {% if per_page==10 %}selected{% endif %}>10 per page</option>
                                    <option value="20" {% if per_page==20 %}selected{% endif %}>20 per page</option>
                                    <option value="25" {% if per_page==25 %}selected{% endif %}>25 per page</option>
                                    <option value="50" {% if per_page==50 %}selected{% endif %}>50 per page</option>
                                    <option value="100" {% if per_page==100 %}selected{% endif %}>100 per page</option>
                                </select>
                            </form>
                        </nav>
                    </div>
                </div>

            </main>
        </div>
    </div>

</body>

</html>